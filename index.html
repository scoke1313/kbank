<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>춘식 점프 물리 로직</title>
    <script src="https://unpkg.com/@rive-app/canvas@latest"></script>
    <style>
        body { margin: 0; background: #333; display: flex; justify-content: center; align-items: center; height: 100vh; }
        /* 요청하신 393x852 사이즈 고정 */
        #game-stage { 
            position: relative; 
            width: 393px; 
            height: 852px; 
            background: #fff; 
            overflow: hidden; 
        }
        /* 캐릭터 사이즈 86x138 고정 */
        #canvas-container {
            position: absolute;
            width: 86px;
            height: 138px;
            bottom: 100px; /* 바닥에서 100px 위를 시작점으로 설정 */
            left: 50%;
            margin-left: -43px; /* 가로 중앙 정렬 */
        }
        canvas { width: 100%; height: 100%; }
    </style>
</head>
<body>

<div id="game-stage">
    <div id="canvas-container">
        <canvas id="canvas"></canvas>
    </div>
</div>

<script>
// --- 물리 파라미터 (속도와 시간 중심) ---
const PHYSICS = {
    gravity: 0.9,       // 중력 (클수록 빨리 떨어짐)
    jumpPower: -18,     // 도약 속도 (클수록 높이 뜀)
    groundY: 0,         // 바닥 기준
    moveSpeed: 6        // 좌우 이동 속도 추가
};

let currentY = 0;
let velocityY = 0;
let posX = 0;           // 좌우 위치 변수
let isJumping = true;   // 자동 점프 활성화
let riveInstance;
let keys = {};          // 키 입력 상태 저장
let currentScale = 1;   // 좌우 반전 상태 (1: 오른쪽, -1: 왼쪽)

// Rive 초기화 함수 (파일 교체용)
function loadRive(fileName) {
    if (riveInstance) riveInstance.cleanup();
    
    riveInstance = new rive.Rive({
        src: fileName,
        canvas: document.getElementById('canvas'),
        autoplay: true,
        stateMachines: 'State Machine 1',
        onLoad: () => {
            riveInstance.resizeDrawingSurfaceToCanvas();
        }
    });
}

// 최초 실행: 공중(대기) 모션 로드
loadRive('kongsik_ingame_air.riv');

function update() {
    // 1. 좌우 이동 로직
    if (keys['ArrowLeft']) {
        posX -= PHYSICS.moveSpeed;
        currentScale = -1; // 왼쪽 반전
    }
    if (keys['ArrowRight']) {
        posX += PHYSICS.moveSpeed;
        currentScale = 1;  // 오른쪽 정방향
    }

    // 2. 수직 점프 로직
    if (isJumping) {
        velocityY += PHYSICS.gravity;
        currentY += velocityY;

        // 바닥 도착 판정 (자동 재점프)
        if (currentY >= PHYSICS.groundY) {
            currentY = PHYSICS.groundY;
            velocityY = PHYSICS.jumpPower; 
            loadRive('kongsik_ingame_air.riv');
        }

        // 캐릭터 위치(X, Y) 및 반전 업데이트
        // 원본의 translateY 구조를 유지하면서 translateX와 scaleX를 병합
        document.getElementById('canvas-container').style.transform = 
            `translate(${posX}px, ${currentY}px) scaleX(${currentScale})`;
    }
    requestAnimationFrame(update);
}

// 입력 감지 (좌우 조작용)
window.addEventListener('keydown', (e) => {
    keys[e.code] = true;
});

window.addEventListener('keyup', (e) => {
    keys[e.code] = false;
});

update();
</script>

</body>
</html>
