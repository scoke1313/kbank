<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>춘핑점핑 (슈퍼 이펙트 패치)</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { margin: 0; padding: 0; background-color: #333; font-family: 'Pretendard', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; touch-action: none; user-select: none; }
        #game-container { position: relative; width: 100%; max-width: 480px; height: 100%; max-height: 850px; background: linear-gradient(to bottom, #89CFF0 0%, #E0F7FA 100%); box-shadow: 0 0 20px rgba(0,0,0,0.5); overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0, 0, 0, 0.7); color: white; text-align: center; z-index: 20; }
        .hidden { display: none !important; }
        h1 { font-size: 32px; color: #FFEF6B; text-shadow: 2px 2px 0 #333; margin-bottom: 10px; }
        .btn { padding: 15px 40px; font-size: 20px; font-weight: bold; color: #333; background-color: #FEE500; border: none; border-radius: 30px; cursor: pointer; box-shadow: 0 5px 0 #cdae04; margin-top: 20px; }
        .btn:active { transform: translateY(5px); box-shadow: none; }
        #score-board { position: absolute; top: 20px; left: 20px; font-size: 20px; font-weight: bold; color: #333; background: rgba(255, 255, 255, 0.9); padding: 8px 16px; border-radius: 20px; z-index: 5; }
        .controls-layer { position: absolute; bottom: 30px; left: 0; width: 100%; height: 100px; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; pointer-events: none; z-index: 15; }
        .control-btn { width: 80px; height: 80px; background: rgba(255, 255, 255, 0.5); border-radius: 50%; border: 4px solid white; pointer-events: auto; display: flex; justify-content: center; align-items: center; font-size: 40px; color: #333; cursor: pointer; transition: background 0.1s; }
        .control-btn:active, .control-btn.pressed { background: rgba(254, 229, 0, 0.8); transform: scale(0.95); }
        .result-card { background: white; color: #333; padding: 30px; border-radius: 20px; width: 80%; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .final-rate { font-size: 48px; font-weight: bold; color: #D1180B; margin: 10px 0; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="score-board">금리: <span id="rate-display">2.0</span>%</div>
    <canvas id="gameCanvas"></canvas>
    <div class="controls-layer">
        <div class="control-btn" id="btn-left">◀</div>
        <div class="control-btn" id="btn-right">▶</div>
    </div>
    <div id="start-screen" class="overlay">
        <h1>춘핑점핑<br><span style="font-size:0.6em; color:white;">(Super Shiny Edition)</span></h1>
        <button class="btn" onclick="startGame()">게임 시작</button>
    </div>
    <div id="game-over-screen" class="overlay hidden">
        <div class="result-card">
            <h3>적금 만기!</h3>
            <p>최종 금리</p>
            <div class="final-rate"><span id="final-rate">0.0</span>%</div>
        </div>
        <button class="btn" onclick="resetGame()">다시 하기</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('rate-display');
    const finalScoreEl = document.getElementById('final-rate');
    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over-screen');
    const btnLeft = document.getElementById('btn-left');
    const btnRight = document.getElementById('btn-right');

    const imgJump = new Image(); imgJump.src = 'chun_pogo1.png'; 
    const imgLand = new Image(); imgLand.src = 'chun_pogo2.png'; 
    
    let imagesLoaded = 0;
    let ratioJump = 1.5, ratioLand = 1.5;
    imgJump.onload = () => { if(imgJump.naturalWidth > 0) ratioJump = imgJump.naturalHeight/imgJump.naturalWidth; imagesLoaded++; };
    imgLand.onload = () => { if(imgLand.naturalWidth > 0) ratioLand = imgLand.naturalHeight/imgLand.naturalWidth; imagesLoaded++; };

    let animationId, isGameOver = false, score = 2.0;
    let platforms = [], items = [], particles = [], clouds = [];

    const GRAVITY = 0.45;
    const JUMP_STRENGTH = -13; 
    const SUPER_JUMP = -22; // ★ 황금 고구마 점프력
    const MOVE_SPEED = 6;
    const FIXED_WIDTH = 80;

    function resize() {
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = canvas.parentElement.clientHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const player = {
        x: 0, y: 0, vx: 0, vy: 0,
        direction: 1, rotation: 0,
        landingTimer: 0, isSuperJumping: 0 // ★ 번쩍임 지속 프레임
    };

    const keys = { right: false, left: false };
    window.addEventListener('keydown', e => { if(e.code === 'ArrowRight') keys.right = true; if(e.code === 'ArrowLeft') keys.left = true; });
    window.addEventListener('keyup', e => { if(e.code === 'ArrowRight') keys.right = false; if(e.code === 'ArrowLeft') keys.left = false; });
    
    function addTouchEvents(btn, keyName) {
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[keyName] = true; btn.classList.add('pressed'); }, { passive: false });
        btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[keyName] = false; btn.classList.remove('pressed'); }, { passive: false });
    }
    addTouchEvents(btnLeft, 'left'); addTouchEvents(btnRight, 'right');

    class Cloud {
        constructor() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height * 0.5; this.radius = Math.random() * 20 + 20; this.speed = Math.random() * 0.3 + 0.1; this.alpha = Math.random() * 0.4 + 0.6; }
        update() { this.x -= this.speed; if (this.x + this.radius * 4 < 0) this.x = canvas.width + this.radius * 4; }
        draw() { ctx.save(); ctx.globalAlpha = this.alpha; ctx.fillStyle = '#FFFFFF'; ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); ctx.fill(); ctx.restore(); }
    }

    class Platform {
        constructor(x, y) { this.x = x; this.y = y; this.width = 100; this.height = 16; this.broken = false; }
        draw() {
            if (this.broken) return;
            ctx.fillStyle = '#8D6E63'; ctx.fillRect(this.x, this.y, this.width, this.height);
            ctx.fillStyle = '#9CCC65'; ctx.fillRect(this.x, this.y, this.width, 6);
        }
    }

    class Item {
        constructor(x, y) { 
            this.x = x; this.y = y; 
            this.size = 27; // ★ 기존 18에서 1.5배 키움
            this.value = Math.random() > 0.7 ? 0.2 : 0.1; 
            this.isSuper = this.value > 0.15; // 황금 고구마 여부
            this.collected = false; this.angle = 0; 
        }
        draw() {
            if (this.collected) return;
            this.angle += 0.1; const floatY = Math.sin(this.angle) * 4;
            ctx.beginPath(); ctx.arc(this.x, this.y + floatY, this.size, 0, Math.PI * 2);
            ctx.fillStyle = this.isSuper ? '#FFD700' : '#E0E0E0'; ctx.fill();
            ctx.shadowBlur = this.isSuper ? 15 : 0; ctx.shadowColor = "yellow";
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();
            ctx.shadowBlur = 0;
            ctx.fillStyle = '#333'; ctx.font = `bold ${this.size * 0.8}px sans-serif`;
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('%', this.x, this.y + floatY);
        }
    }

    class Particle {
        constructor(x, y) { this.x = x; this.y = y; this.vx = (Math.random() - 0.5) * 6; this.vy = (Math.random() - 0.5) * 6; this.life = 1.0; }
        update() { this.x += this.vx; this.y += this.vy; this.vy += 0.3; this.life -= 0.05; }
        draw() { ctx.globalAlpha = this.life; ctx.fillStyle = '#8D6E63'; ctx.fillRect(this.x, this.y, 6, 6); ctx.globalAlpha = 1.0; }
    }

    function init() {
        score = 2.0; scoreEl.innerText = score.toFixed(1);
        player.x = canvas.width / 2; player.y = canvas.height - 200; player.vy = -10; player.isSuperJumping = 0;
        platforms = []; items = []; particles = []; clouds = [];
        for(let i=0; i<8; i++) clouds.push(new Cloud());
        platforms.push(new Platform(canvas.width / 2 - 50, canvas.height - 50)); 
        for (let i = 0; i < 7; i++) generatePlatform(canvas.height - 150 - i * 90);
    }

    function generatePlatform(y) {
        const x = Math.random() * (canvas.width - 100);
        platforms.push(new Platform(x, y));
        if (Math.random() < 0.35) items.push(new Item(x + 50, y - 40));
    }

    function drawPlayer() {
        ctx.save();
        ctx.translate(player.x, player.y);
        ctx.scale(-player.direction, 1);

        // ★ 슈퍼 점프 번쩍임 효과 (이미지 없이 Canvas 효과로만 처리)
        if (player.isSuperJumping > 0) {
            player.isSuperJumping--;
            // 사인파를 이용해 투명도를 0.3 ~ 1.0 사이로 빠르게 조절
            ctx.globalAlpha = 0.5 + Math.sin(Date.now() * 0.05) * 0.5;
            ctx.shadowBlur = 30;
            ctx.shadowColor = "white";
        }

        let currentImg = player.landingTimer > 0 ? imgLand : imgJump;
        let currentRatio = player.landingTimer > 0 ? ratioLand : ratioJump;
        let currentHeight = FIXED_WIDTH * currentRatio;

        let targetRot = Math.max(-0.15, Math.min(0.15, player.vx * 0.02 * player.direction * -1));
        player.rotation += (targetRot - player.rotation) * 0.1;

        ctx.translate(0, currentHeight / 2); ctx.rotate(player.rotation); ctx.translate(0, -currentHeight / 2);

        if (imagesLoaded >= 2) {
            ctx.drawImage(currentImg, -FIXED_WIDTH/2, -currentHeight/2, FIXED_WIDTH, currentHeight);
        } else {
            ctx.fillStyle = '#FEE500'; ctx.fillRect(-20, -30, 40, 60);
        }
        ctx.restore();
    }

    function update() {
        if (isGameOver) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        clouds.forEach(c => { c.update(); c.draw(); });

        if (keys.left) { player.vx = -MOVE_SPEED; player.direction = -1; }
        else if (keys.right) { player.vx = MOVE_SPEED; player.direction = 1; }
        else player.vx *= 0.8;

        player.x += player.vx;
        if (player.x < -20) player.x = canvas.width + 20;
        if (player.x > canvas.width + 20) player.x = -20;

        if (player.landingTimer > 0) {
            player.landingTimer--; 
            if (player.landingTimer === 0) {
                // ★ 슈퍼 점프 상태면 더 높이 뜀
                player.vy = (player.isSuperJumping > 0) ? SUPER_JUMP : JUMP_STRENGTH;
            }
        } else {
            player.vy += GRAVITY;
            player.y += player.vy;
        }

        if (player.y < canvas.height / 2.5 && player.vy < 0) {
            let dy = -player.vy;
            player.y += dy;
            platforms.forEach(p => p.y += dy);
            items.forEach(i => i.y += dy);
            particles.forEach(p => p.y += dy);
            clouds.forEach(c => c.y += dy * 0.5);
            if (platforms[platforms.length-1].y > 90) generatePlatform(platforms[platforms.length-1].y - 90);
        }

        let feetY = player.y + (FIXED_WIDTH * ratioJump / 2);
        if (player.landingTimer === 0 && player.vy > 0) {
            platforms.forEach(p => {
                if (!p.broken && player.x > p.x - 20 && player.x < p.x + p.width + 20 && feetY >= p.y && feetY <= p.y + 20) {
                    player.landingTimer = 8;
                    player.y = p.y - (FIXED_WIDTH * ratioLand / 2);
                    player.vy = 0;
                    if (platforms.indexOf(p) !== 0) {
                        p.broken = true;
                        for(let k=0; k<10; k++) particles.push(new Particle(p.x + 50, p.y));
                    }
                }
            });
        }

        items.forEach(item => {
            if (!item.collected && Math.abs(player.x - item.x) < 50 && Math.abs(player.y - item.y) < 50) {
                item.collected = true;
                score += item.value;
                scoreEl.innerText = score.toFixed(1);
                // ★ 황금 고구마(슈퍼 아이템) 먹었을 때 효과 활성화
                if(item.isSuper) {
                    player.isSuperJumping = 60; // 약 1초 동안 번쩍임
                }
            }
        });

        platforms = platforms.filter(p => p.y < canvas.height);
        items = items.filter(i => i.y < canvas.height);
        particles = particles.filter(p => p.life > 0);
        platforms.forEach(p => p.draw());
        items.forEach(i => i.draw());
        particles.forEach(p => { p.update(); p.draw(); });
        drawPlayer();

        if (player.y > canvas.height + 100) endGame();
        else animationId = requestAnimationFrame(update);
    }

    function startGame() { startScreen.classList.add('hidden'); gameOverScreen.classList.add('hidden'); isGameOver = false; init(); update(); }
    function endGame() { isGameOver = true; cancelAnimationFrame(animationId); finalScoreEl.innerText = score.toFixed(1); gameOverScreen.classList.remove('hidden'); }
    function resetGame() { startGame(); }
</script>
</body>
</html>
