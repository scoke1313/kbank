// 1. 상태 변수 설정
let velocityY = 0;
let gravity = 0.8;
let jumpPower = -15;
let isJumping = false;
let groundY = 500; // 바닥 높이

// 2. Rive 애니메이션 인스턴스 (공중/착지 두 파일 로드 가정)
let riveAir, riveLand;

// 점프 함수
function performJump() {
    if (isJumping) return; // 이미 점프 중이면 무시

    isJumping = true;
    velocityY = jumpPower;

    // '공중' 애니메이션 재생
    playAnimation(riveAir, "jumping_loop");
    console.log("춘식 도약!");
}

// 프레임 업데이트 로직 (Game Loop)
function update() {
    if (isJumping) {
        // 중력 적용
        velocityY += gravity;
        chunsik.y += velocityY;

        // 정점 부근에서 애니메이션 속도 조절 (체공 느낌)
        if (Math.abs(velocityY) < 2) {
            riveAir.setNumberStateAt("Speed", 0.5); 
        }

        // 바닥 착지 판정
        if (chunsik.y >= groundY) {
            chunsik.y = groundY;
            isJumping = false;
            triggerLanding(); // 탄성 착지 실행
        }
    }
}

// 3. 탄성 착지 로직 (Elastic Landing)
function triggerLanding() {
    // 공중 애니메이션 정지
    riveAir.stop();

    // '착지' 애니메이션 재생
    // 이 파일 안에는 춘식이가 찌그러졌다가 펴지는(Squash & Stretch) 모션이 포함되어야 합니다.
    playAnimation(riveLand, "land_elastic");

    // 착지 충격에 따른 화면 흔들림(Shake) 효과 추가 (디테일)
    applyScreenShake(velocityY * 0.5); 

    console.log("춘식 착지! 탄성 적용됨.");
}

// Rive 제어 유틸리티
function playAnimation(instance, name) {
    const inputs = instance.stateMachineInputs('State Machine 1');
    const trigger = inputs.find(i => i.name === name);
    if (trigger) trigger.fire();
}
